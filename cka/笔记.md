### `rbac`

题干：

```
设置配置环境：
[candidate@node-1] $ kubectl config use-context k8s

Context
为部署流水线创建一个新的 ClusterRole 并将其绑定到范围为特定的 namespace 的特定 ServiceAccount。

Task
创建一个名为 deployment-clusterrole 且仅允许创建以下资源类型的新 ClusterRole：
Deployment
StatefulSet
DaemonSet
在现有的 namespace app-team1 中创建一个名为 cicd-token 的新 ServiceAccount。
限于 namespace app-team1 中，将新的 ClusterRole deployment-clusterrole 绑定到新的 ServiceAccount cicd-token。
```

题解：

- K8S官方文档位置：[使用 RBAC 鉴权 | Kubernetes](https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/#kubectl-create-role)

  - ServicAccount
  - clusterrole
  - rolebing

- 重点区别：RoleBinding 和 ClusterRoleBinding 区别 ：名字空间内定义角色，应该使用 Role； 如果你希望定义集群范围的角色，应该使用 ClusterRole。

- 重点区别：Role 和 ClusterRole 区别

- 创建成功后如何验证：

  - 通过describe：

    - ```sh
       kubectl -n app-team1 describe rolebinding cicd-token-rolebinding
      ```

    - ```sh
       kubectl auth can-i create deployment --as system:serviceaccount:app-team1:cicd-token 
       
       NO
      ```

    - ```sh
      kubectl auth can-i create deployment -n app-team1 --as system:serviceaccount:app-team1:cicd-token 
      
      YES
      ```

### `pod`

本地练习 需要安装metric-server

```
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.7.2/components.yaml
```

题干：

```
# 查看 pod 名称  -A 是所有 namespace
$ kubectl top pod -l name=cpu-loader --sort-by=cpu -A

# 将 cpu 占用最多的 pod 的 name 写入/opt/test1.txt 文件 
$ echo "查出来的 Pod Name" > /opt/KUTR000401/KUTR00401.txt
```

题解：

- k8s 官方文档：[kubectl 快速参考 | Kubernetes](https://kubernetes.io/zh-cn/docs/reference/kubectl/quick-reference/#interacting-with-running-pods)
