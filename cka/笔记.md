`rbac`
https://ai-feier.github.io/p/2024-cka-%E9%A2%98%E5%BA%93/

题干：

```
设置配置环境：
[candidate@node-1] $ kubectl config use-context k8s

Context
为部署流水线创建一个新的 ClusterRole 并将其绑定到范围为特定的 namespace 的特定 ServiceAccount。

Task
创建一个名为 deployment-clusterrole 且仅允许创建以下资源类型的新 ClusterRole：
Deployment
StatefulSet
DaemonSet
在现有的 namespace app-team1 中创建一个名为 cicd-token 的新 ServiceAccount。
限于 namespace app-team1 中，将新的 ClusterRole deployment-clusterrole 绑定到新的 ServiceAccount cicd-token。
```

题解：

- K8S官方文档位置：[使用 RBAC 鉴权 | Kubernetes](https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/#kubectl-create-role)

  - ServicAccount
  - clusterrole
  - rolebing

- 重点区别：RoleBinding 和 ClusterRoleBinding 区别 ：名字空间内定义角色，应该使用 Role； 如果你希望定义集群范围的角色，应该使用 ClusterRole。

- 重点区别：Role 和 ClusterRole 区别

- 创建成功后如何验证：

  - 通过describe：

    - ```sh
       kubectl -n app-team1 describe rolebinding cicd-token-rolebinding
      ```

    - ```sh
       kubectl auth can-i create deployment --as system:serviceaccount:app-team1:cicd-token 
       
       NO
      ```

    - ```sh
      kubectl auth can-i create deployment -n app-team1 --as system:serviceaccount:app-team1:cicd-token 
      
      YES
      ```

